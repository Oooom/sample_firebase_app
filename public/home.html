<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>RecipeDuniya.com</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    
    <!-- Material Design Imports -->
    <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    
    <!-- Firebase Imports -->
    <script defer src="/__/firebase/7.24.0/firebase-app.js"></script>
    <script defer src="/__/firebase/7.24.0/firebase-auth.js"></script>
    
    
    <script defer src="/__/firebase/7.24.0/firebase-firestore.js"></script>
    
    <script defer src="/__/firebase/init.js"></script>
    
    
    <!-- Custom Script Start -->
    <script type="text/javascript">
        initApp = function () {
            firebase.auth().onAuthStateChanged(function (user) {
                if (user) {
                    var displayName = user.displayName;
                    
                    sign_out_button.textContent += ` (${user.displayName})`
                    
                    var db = firebase.firestore()
                    
                    db.collection("recipes").get().then((querySnapshot) => {
                        //prints all documents
                        querySnapshot.forEach((doc) => {
                            
                            //.data() returns the document as json
                            console.log(doc.data());
                            var div = document.createElement("div");
                            div.setAttribute("class", "col-md-4")
                            var div2 = document.createElement("div");
                            div2.setAttribute("class", "card")
                            var div_card_body = document.createElement("div");
                            div_card_body.setAttribute("class", "card-body")
                            var h = document.createElement("h5");
                            h.setAttribute("class", "card-title")
                            h.textContent = doc.data().title;
                            var a = document.createElement("button");
                            a.setAttribute("class", "btn btn-primary");
                            a.setAttribute("onclick", '"viewRecipe(\''+doc.data().title+'\'"');
                            a.textContent = "View recipe"
                            div_card_body.appendChild(h)
                            div_card_body.appendChild(a)
                            div2.appendChild(div_card_body)
                            div.appendChild(div2)
                            document.getElementById("recipes").appendChild(div);
                        });
                    });
                    
                } else {
                    window.location = "/";
                }
            }, function (error) {
                console.warn(error);
            });
        };
        
        window.addEventListener('load', function () {
            initApp()
        });
        
        function signOut(){
            firebase.auth().signOut().then(function() {
                window.location = "/";
            }, function(error) {
                console.warn(error)
            });
        }
    </script>
    
    <style>
        body, html{
            margin: 0;
            padding: 0;
            font-family: Arial, Helvetica, sans-serif;
            padding-left: 10px;
            padding-right: 10px;
        }
        
        #header{
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        #sign_button{
            padding: 10px;
            font-weight: bold;
            border: 0px;
            color: white;
            background-color: red;
        }
        
        #chip_template{
            display: none
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-primary bg-dark">
        <a class="navbar-brand" href="#">Welcome to RecipeDuniya.com</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
           
          </ul>
          <form class="form-inline my-2 my-lg-0">
            <button class="btn btn-outline-success my-2 my-sm-0 foo-button" onclick="signOut()"><div class="mdc-button__ripple"></div>
                <span id="sign_out_button" class="mdc-button__label">Sign Out</span>
            </button>
             </form>
        </div>
      </nav>
    <!-- <div id="header">
        <h1>Welcome to RecipeDuniya.com</h1>
        
        <button class="mdc-button foo-button" onclick="signOut()">
            <div class="mdc-button__ripple"></div>
            <span id="sign_out_button" class="mdc-button__label">Sign Out</span>
        </button>
        
    </div> -->
    <div>
        Recipes:
        <div id="recipes" class="recipes row">

        </div>
        <br>
        <br>
        <!-- <div class="card" style="width: 18rem;">
            <div class="card-body">
              <h5 class="card-title">Card title</h5>
              <a href="#" class="btn btn-primary">Go somewhere</a>
            </div>
          </div>
        <label class="mdc-text-field mdc-text-field--outlined">
            <input id="ingredient_ip" type="text" class="mdc-text-field__input" aria-labelledby="my-label-id">
            <span class="mdc-notched-outline">
                <span class="mdc-notched-outline__leading"></span>
                <span class="mdc-notched-outline__trailing"></span>
            </span>
        </label>
        
        <button class="mdc-button mdc-button--outlined" onclick="addChipCaller()">
            <div class="mdc-button__ripple"></div>
            <span class="mdc-button__label">Add Ingredient</span>
        </button>
        
        <div class="mdc-chip-set mdc-chip-set--input" role="grid"> -->
            
        </div>
        
    </div>
    
    
    <!-- TEMPLATE NODE -->
    <div id="chip_template" class="mdc-chip" role="row">
        <div class="mdc-chip__ripple"></div>
        <span role="gridcell">
            <span role="button" tabindex="0" class="mdc-chip__primary-action">
                <span class="chip_title" class="mdc-chip__text">Jane Smith</span>
            </span>
        </span>
        <span role="gridcell">
            <i class="material-icons mdc-chip__icon mdc-chip__icon--trailing" tabindex="-1" role="button" onclick="removeChip(this)">cancel</i>
        </span>
    </div>
    
    
    <script>
        mdc.ripple.MDCRipple.attachTo(document.querySelector('.foo-button'));
        
        var MDCTextField = mdc.textField.MDCTextField
        const textField = new MDCTextField(document.querySelector('.mdc-text-field'));
        
        const MDCChipSet = mdc.chips.MDCChipSet;
        const MDCChip    = mdc.chips.MDCChip;
        const chipSetEl  = document.querySelector('.mdc-chip-set');
        const chipSet    = new MDCChipSet(chipSetEl);
        
        
        
        var chips = []
        var ingredients_available = []
        
        
        function removeChip(root){
            var target = chips.filter( (chip)=>chip.root == root.parentElement.parentElement )[0]
            
            ingredients_available.splice( chips.indexOf(target), 1 )
            target.beginExit()
            
            console.log(ingredients_available)
        }
        
        function addChip(title){
            var clone = chip_template.cloneNode(true)
            clone.id = ""
            clone.getElementsByClassName('chip_title')[0].innerText = title
            
            chipSetEl.appendChild(clone)
            chipSet.addChip(clone)
            
            chips.push(new MDCChip(clone))
            ingredients_available.push(title)
            
            console.log(ingredients_available)
        }
        
        function addChipCaller(){
            var title = ingredient_ip.value
            
            addChip(title)
            
            ingredient_ip.value = ""
        }
        
    </script>
</body>

</html>